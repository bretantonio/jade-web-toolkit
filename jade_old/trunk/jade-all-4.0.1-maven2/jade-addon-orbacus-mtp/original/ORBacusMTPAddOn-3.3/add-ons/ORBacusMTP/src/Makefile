# Makefile for IIOP MTP 

# The following targets are not file names
.PHONY: all batch classes clean lib

JADELIB     =   ../../../lib/jade.jar
OBHOME = ../../..
ORBACUSLIB  =   $(OBHOME)/lib/OB.jar
OBNAMINGLIB  =  $(OBHOME)/lib/OBNaming.jar
LIBNAME	    =	../lib/iiopOB.jar
CLSDIR      =	../classes
BATCH_MAKE  =	../makeORBacusMTP.bat
BATCH_CLEAN =	../clean.bat
BATCH_DIST  =	../makeORBacusMTPdist.bat

AR = jar
ARFLAGS = cvf
MAKE = make
IDLCC = jidl
JC = javac
JFLAGS = -deprecation -O -d $(CLSDIR) -classpath .:$(JADELIB):$(ORBACUSLIB):$(OBNAMINGLIB)

SOURCES     = 	MessageTransportProtocol.java
IDLSPEC     =   fipa.idl

IDLSTUBS    =   FIPA/AgentID.java \
		FIPA/AgentIDHelper.java \
		FIPA/AgentIDHolder.java \
		FIPA/AgentIDsHelper.java \
		FIPA/AgentIDsHolder.java \
		FIPA/DateTime.java \
		FIPA/DateTimeHelper.java \
		FIPA/DateTimeHolder.java \
		FIPA/Envelope.java \
		FIPA/EnvelopeHelper.java \
		FIPA/EnvelopeHolder.java \
		FIPA/EnvelopesHelper.java \
		FIPA/EnvelopesHolder.java \
		FIPA/FipaMessage.java \
		FIPA/FipaMessageHelper.java \
		FIPA/FipaMessageHolder.java \
		FIPA/MTS.java \
		FIPA/MTSHelper.java \
		FIPA/MTSHolder.java \
		FIPA/OptAgentIDHelper.java \
		FIPA/OptAgentIDHolder.java \
		FIPA/OptDateTimeHelper.java \
		FIPA/OptDateTimeHolder.java \
		FIPA/OptReceivedObjectHelper.java \
		FIPA/OptReceivedObjectHolder.java \
		FIPA/OptTransportBehaviourTypeHelper.java \
		FIPA/OptTransportBehaviourTypeHolder.java \
		FIPA/PayloadHelper.java \
		FIPA/PayloadHolder.java \
		FIPA/Property.java \
		FIPA/PropertyHelper.java \
		FIPA/PropertyHolder.java \
		FIPA/ReceivedObject.java \
		FIPA/ReceivedObjectHelper.java \
		FIPA/ReceivedObjectHolder.java \
		FIPA/TransportBehaviourTypeHelper.java \
		FIPA/TransportBehaviourTypeHolder.java \
		FIPA/URLHelper.java \
		FIPA/MTSOperations.java \
		FIPA/MTSPOA.java \
		FIPA/_MTSStub.java \
		FIPA/stringsHelper.java \
		FIPA/stringsHolder.java

all: idl classes lib
	@echo
	@echo Build complete.
	@echo

idl: $(IDLSTUBS)
	@echo IDL stubs and skeletons generated

$(IDLSTUBS): $(IDLSPEC)
	$(IDLCC) $<

classes:
	$(JC) $(JFLAGS) $(SOURCES)

lib:
	cd $(CLSDIR); \
	$(AR) $(ARFLAGS) $(LIBNAME) *; \
	rm -rf $(CLSDIR)/* `find . -name '*~'` `find . -name '#*#'`

dist:
	cd ../../..; \
	$(AR) $(ARFLAGS) ORBacusMTPAddon.zip add-ons/ORBacusMTP

batch:
	rm -f $(BATCH_MAKE) $(BATCH_CLEAN) $(BATCH_DIST)
	echo '@REM ===============================================================' > $(BATCH_MAKE)
	echo '@REM =           Generated by JADE Makefile. DO NOT EDIT           =' >> $(BATCH_MAKE)
	echo '@REM ===============================================================' >> $(BATCH_MAKE)
	echo >> $(BATCH_MAKE)
	echo 'cd src' >> $(BATCH_MAKE)
	echo $(IDLCC) $(IDLSPEC) >> $(BATCH_MAKE)
	echo >> $(BATCH_MAKE)
	echo '$(JC) $(subst :,;,$(subst /,\,$(JFLAGS))) $(subst /,\,$(SOURCES))' >> $(BATCH_MAKE)
	echo >> $(BATCH_MAKE)
	echo 'cd $(subst /,\,$(CLSDIR))' >> $(BATCH_MAKE)
	echo >> $(BATCH_MAKE)
	echo '$(AR) $(ARFLAGS) $(LIBNAME) *' >> $(BATCH_MAKE)
	echo 'rmdir /S /Q $(subst /,\,$(CLSDIR))\FIPA' >> $(BATCH_MAKE)  #FOR WIN NT 4/ Win 200
	echo 'rmdir /S /Q $(subst /,\,$(CLSDIR))\orbacus' >> $(BATCH_MAKE)  #FOR WIN NT 4/ Win2000
	echo 'deltree /Y $(subst /,\,$(CLSDIR))\FIPA' >> $(BATCH_MAKE) #for Win 95/98
	echo 'deltree /Y $(subst /,\,$(CLSDIR))\orbacus' >> $(BATCH_MAKE) #for Win 95/98
	echo 'cd ..\..\..' >> $(BATCH_MAKE)
	echo '$(AR) $(ARFLAGS) ORBacusMTPAddon.zip add-ons\ORBacusMTP' >> $(BATCH_MAKE)
	echo >> $(BATCH_MAKE)
	echo '@REM ===============================================================' > $(BATCH_CLEAN)
	echo '@REM =           Generated by JADE Makefile. DO NOT EDIT           =' >> $(BATCH_CLEAN)
	echo '@REM ===============================================================' >> $(BATCH_CLEAN)
	echo >> $(BATCH_CLEAN)
	echo >> $(BATCH_CLEAN)
	echo 'cd src' >> $(BATCH_CLEAN)
	#echo 'del $(subst /,\,$(IDLSTUBS))' >> $(BATCH_CLEAN)
	echo 'del $(subst /,\,$(LIBNAME))' >> $(BATCH_CLEAN)
	echo 'rmdir /S /Q $(subst /,\,$(CLSDIR))\FIPA' >> $(BATCH_CLEAN) # For Win NT 4/Windows 2000
	echo 'rmdir /S /Q $(subst /,\,$(CLSDIR))\orbacus' >> $(BATCH_CLEAN) # For Win NT 4/Windows 2000
	echo 'deltree /Y $(subst /,\,$(CLSDIR))\orbacus' >> $(BATCH_CLEAN)  # For Win 95/98
	echo 'deltree /Y $(subst /,\,$(CLSDIR))\FIPA' >> $(BATCH_CLEAN) #for Win 95/98
	echo '@REM ===============================================================' > $(BATCH_DIST)
	echo '@REM =           Generated by JADE Makefile. DO NOT EDIT           =' >> $(BATCH_DIST)
	echo '@REM ===============================================================' >> $(BATCH_DIST)
	#echo 'cd  ..' >> $(BATCH_DIST)
	echo 'call makeORBacusMTP.bat' >> $(BATCH_DIST)
clean:
	#rm -rf $(IDLSTUBS) $(CLSDIR) $(LIBNAME) `find . -name '*~'` `find . -name '#*#'`
	rm -rf $(CLSDIR)/* $(LIBNAME) `find . -name '*~'` `find . -name '#*#'`
	#mkdir -p $(CLSDIR)
